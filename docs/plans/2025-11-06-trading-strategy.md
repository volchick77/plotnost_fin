# Торговая стратегия: Пробой и отскок от плотностей Order Book

**Дата:** 2025-11-06
**Версия:** 1.0
**Биржа:** Bybit (основная), в будущем Binance и BitGet
**Инструмент:** Фьючерсы USDT-M

---

## Обзор стратегии

Автоматизированная торговая стратегия, основанная на анализе плотностей (крупных лимитных ордеров и кластеров) в order book биржи. Стратегия использует два основных сценария входа: **пробой плотности** и **отскок от плотности**, учитывая направление текущего тренда монеты.

### Ключевые принципы

1. **Трендовая торговля**: Входы только в направлении текущего тренда
2. **Минимальные риски**: Малые позиции ($0.1), изолированная маржа, быстрый перевод в безубыток
3. **Адаптивность**: Параметры настраиваются для каждой монеты на основе собранной статистики
4. **Динамический фокус**: Торговля только на самых активных монетах (топ-20 растущих + топ-20 падающих)

---

## Определение плотностей

### Что такое плотность?

**Плотность** - это крупный лимитный ордер или кластер ордеров на определенном ценовом уровне в стакане (order book), который может служить уровнем поддержки или сопротивления.

### Критерии идентификации

Плотность определяется по **комбинации трех факторов** (все параметры настраиваемые):

1. **Абсолютный объем**
   - Ордер или кластер > X USDT (начальное значение: 50,000 USDT)
   - Подходит для стабильной идентификации на высоколиквидных монетах

2. **Относительный объем**
   - Объем в Y раз больше среднего объема на соседних 5 ценовых уровнях
   - Начальное значение: 3x
   - Позволяет адаптироваться к разным монетам

3. **Процент от общего объема стакана**
   - > Z% от суммарного объема bid или ask
   - Начальное значение: 5%
   - Учитывает общую ликвидность монеты

### Кластеры ордеров

**Кластер** - группа ордеров в узком ценовом диапазоне (0.1-0.2% от текущей цены), рассматриваемая как единая плотность. Суммарный объем кластера учитывается при проверке критериев.

---

## Определение тренда

Направление тренда определяется **комбинацией двух факторов**:

### 1. Изменение цены за 24 часа

- **Рост**: положительное изменение цены > X% (например, +2%)
- **Падение**: отрицательное изменение < -X%
- Простой и надежный индикатор общего направления

### 2. Поведение Order Book

- **Рост**: смещение объема в asks (агрессивные покупки), биды увеличиваются
- **Падение**: смещение объема в bids (агрессивные продажи), аски увеличиваются
- Real-time индикатор текущего давления

**Тренд считается подтвержденным**, когда оба фактора указывают в одном направлении.

---

## Сценарий 1: Пробой плотности

### Концепция

Когда цена пробивает значительную плотность, это сигнализирует о сильном движении в направлении пробоя. Особенно сильный сигнал, если движение идет в "новую ценовую территорию" (за пределы недавних локальных максимумов/минимумов).

### Условия для входа

**Обязательные условия:**

1. **Направление тренда совпадает с пробоем**
   - Рост + пробой вверх (через ask плотность)
   - Падение + пробой вниз (через bid плотность)

2. **Плотность разъедена на 30%** (настраиваемый параметр)
   - Объем плотности уменьшился на 30% от первоначального
   - Ордера исполняются или отменяются, но уровень пробивается

3. **Цена пробила ценовой уровень плотности**
   - Подтверждение пробоя price action

**Приоритетные условия (усиливают сигнал):**

4. **Движение в "новую территорию"**
   - Пробой вверх: цена выше локального максимума за последние N часов (1-4 часа)
   - Пробой вниз: цена ниже локального минимума
   - Такие движения имеют больший потенциал продолжения

### Управление позицией при пробое

**Вход:**
- Размер позиции: **$0.1**
- Плечо: **10x**
- Тип маржи: **ИЗОЛИРОВАННАЯ** (критично!)
- Момент входа: когда плотность разъедена на 30%

**Stop-Loss:**
- Начальный: **минимально возможный** (0.1-0.2% от цены входа)
- Логика: минимизация потерь при ложном пробое
- После достижения +0.5% прибыли → **перенос в безубыток**
- Даже если выбьет, максимальный убыток = комиссия биржи

**Take-Profit (динамический):**

Выход при любом из условий:

1. **Замедление движения**
   - Скорость изменения цены упала в X раз (настраиваемо)
   - Признак истощения импульса

2. **Встречная плотность**
   - Обнаружена значимая плотность в направлении движения
   - Может остановить движение

3. **Агрессивные встречные ордера**
   - Резкое увеличение объема в противоположную сторону
   - Признак разворота

4. **Возврат на проторенные уровни**
   - Цена вернулась в диапазон локальных max/min за последние 1-4 часа
   - Движение теряет силу после входа в знакомую зону

### Пример пробоя (LONG)

```
Ситуация:
- BTCUSDT, тренд: рост (+3% за 24h)
- Order book: ask плотность на 50,000 USDT
- Цена: 49,950 USDT, приближается к плотности на 50,000

Развитие:
1. Плотность начинает разъедаться: 50,000 → 40,000 → 35,000 USDT
2. Плотность разъедена на 30% (осталось 35,000 из 50,000)
3. Цена пробила 50,000 USDT
4. Локальный максимум за 2 часа был 49,800 → движение в новую территорию

Действия:
- Вход LONG на 50,010 USDT, размер $0.1, плечо 10x
- Stop-loss: 49,960 USDT (-0.1%)
- При достижении 50,260 (+0.5%) → stop-loss → 50,010 (безубыток)
- Мониторинг условий для выхода
```

---

## Сценарий 2: Отскок от плотности

### Концепция

Когда цена подходит к плотности, но плотность "держит" уровень (не разъедается), высока вероятность отскока. Стратегия использует плотности как уровни поддержки/сопротивления.

### Условия для входа

**Обязательные условия:**

1. **Направление тренда совпадает с ожидаемым отскоком**
   - Падение + плотность снизу (bid) → ожидаем отскок вверх (LONG)
   - Рост + плотность сверху (ask) → ожидаем отскок вниз (SHORT)

2. **Цена коснулась плотности**
   - Цена в пределах 0.1-0.2% от уровня плотности
   - "Касание" подтверждено

3. **Плотность НЕ разъедается**
   - Объем плотности стабилен или растет
   - Ордера НЕ исполняются агрессивно
   - Уровень "держит"

4. **Торговая активность невысокая**
   - Нет резкого повышения объема торгов
   - Нет агрессивных сделок через плотность
   - Рынок "тестирует" уровень, но не пробивает

### Управление позицией при отскоке

**Вход:**
- Размер позиции: **$0.1**
- Плечо: **10x**
- Тип маржи: **ИЗОЛИРОВАННАЯ**
- Момент входа: после касания плотности и подтверждения стабильности

**Stop-Loss:**
- Размещение: **сразу за плотностью**
- Логика: если плотность пробита → отскок не состоялся
- Пример: плотность на 50,000 → stop-loss на 49,970 для LONG
- Расстояние: обычно 0.2-0.3% от входа

**Дополнительное правило защиты:**
- Если плотность разъедается на **60-70%** → выход из позиции
- Даже если stop-loss еще не достигнут
- Логика: плотность слабеет, отскок под вопросом

**Take-Profit (динамический):**

Те же условия, что и для пробоя:
1. Замедление движения
2. Встречная плотность
3. Агрессивные встречные ордера
4. Возврат на проторенные уровни

### Пример отскока (LONG)

```
Ситуация:
- ETHUSDT, тренд: падение (-4% за 24h)
- Order book: bid плотность на 3,000 USDT (100,000 USDT объем)
- Цена: 3,010 USDT, падает к плотности

Развитие:
1. Цена касается 3,002 USDT (в пределах 0.1% от плотности)
2. Плотность стабильна: объем 100,000 → 98,000 → 101,000 USDT
3. Торговая активность низкая, агрессивных продаж нет
4. Цена начинает разворачиваться от уровня

Действия:
- Вход LONG на 3,005 USDT, размер $0.1, плечо 10x
- Stop-loss: 2,995 USDT (за плотностью, -0.33%)
- Мониторинг плотности: если разъедена на 60-70% → выход
- Мониторинг условий для take-profit

Сценарий выхода при разъедании:
- Плотность: 100,000 → 60,000 USDT (разъедена на 40%)
- Плотность: 60,000 → 35,000 USDT (разъедена на 65% от начала)
- Выход по рынку, даже если цена еще 3,003 (не достигла stop-loss)
```

---

## Динамический выбор монет

### Стратегия фокусировки

Бот НЕ торгует все монеты подряд. Вместо этого:

1. **Мониторинг всех монет биржи** (пассивно, через API)
2. **Активная торговля только топ-40:**
   - Топ-20 растущих монет (по объему торгов + положительное изменение цены)
   - Топ-20 падающих монет (по объему торгов + отрицательное изменение цены)

### Обновление списка

- **Частота:** каждые 5-10 минут
- **Источник данных:** 24h статистика с биржи (volume, price change %)
- **Действия:**
  - Отключение WebSocket для монет, выпавших из топ-40
  - Подключение WebSocket для новых монет в топ-40
  - Плавная ротация без остановки торговли

### Логика приоритизации

**Почему фокус на активных монетах?**

1. **Высокая ликвидность** → плотности более значимы
2. **Сильные движения** → больший потенциал прибыли
3. **Четкие тренды** → надежнее определение направления
4. **Эффективность ресурсов** → не тратим на "мертвые" монеты

---

## Управление капиталом

### Параметры тестирования

- **Размер позиции:** $0.1 (минимально возможный)
- **Плечо:** 10x (для реалистичного тестирования будущей работы)
- **Максимум одновременных позиций:** 5-10 (настраиваемо)
- **Максимальная экспозиция:** не более 5% от депозита в открытых позициях

### После тестирования

- **Процентная система:** X% от депозита на сделку (например, 1-2%)
- **Ограничение количества сделок:** максимум Y открытых позиций
- **Адаптивный sizing:** возможно, разный размер для пробоя vs отскока

### Соотношение риск/прибыль

**Философия стратегии:**

- **Высокий процент неудачных сделок** - это нормально
- **Минимальные потери** на каждой неудачной сделке (stop-loss в безубытке)
- **Одна успешная сделка** перекрывает множество неудачных

**Пример:**
```
10 сделок:
- 7 неудачных: -0.1% каждая = -0.7%
- 3 успешных: +3%, +5%, +2% = +10%
- Итого: +9.3% прибыли
```

---

## Сбор данных и адаптация стратегии

### Цель сбора данных

Выявить паттерны поведения каждой монеты для оптимизации параметров стратегии.

### Ключевые вопросы для анализа

1. **Какие монеты лучше работают с пробоями?**
   - Определить монеты с высоким win-rate на breakout

2. **Какие монеты лучше работают с отскоками?**
   - Определить монеты с высоким win-rate на bounce

3. **Сколько спуфинга (ложных плотностей)?**
   - Плотности, которые исчезают до касания цены
   - Настройка фильтров для игнорирования спуфинга

4. **В каких условиях монеты лучше отрабатывают?**
   - Время суток, волатильность, размер плотности
   - Оптимизация условий входа

5. **Средний размер движения после сигнала?**
   - Пробой: в среднем на сколько % идет движение
   - Отскок: в среднем на сколько % идет движение
   - Настройка динамического take-profit

### Данные для сбора

**Для каждой сделки:**
- Все параметры сигнала (размер плотности, % разъедания, расстояние stop-loss)
- Результат (прибыль/убыток, причина выхода)
- Контекст (время суток, волатильность, тренд)

**Исторические данные:**
- Снапшоты order book каждые 5-10 минут
- История плотностей (появление, изменение, исчезновение)
- Лента сделок на критических уровнях

### Применение данных

**Адаптивные параметры для каждой монеты:**

```
BTC: лучше работает на пробоях, плотности стабильные
→ preferred_strategy: 'breakout'
→ density_threshold выше (фильтруем мелкие)

ETH: много спуфинга, хорошие отскоки от крупных плотностей
→ preferred_strategy: 'bounce'
→ density_threshold_relative выше (только очень крупные)

DOGE: волатильная, быстрые движения
→ take_profit более агрессивный
→ stop_loss чуть шире
```

**Постоянная оптимизация:** параметры обновляются раз в неделю/месяц на основе накопленной статистики.

---

## Риски и ограничения стратегии

### Известные риски

1. **Спуфинг**
   - Ложные плотности, которые исчезают
   - Митигация: требование стабильности плотности, адаптивные фильтры

2. **Проскальзывание**
   - Исполнение по худшей цене при волатильности
   - Митигация: минимальные позиции, изолированная маржа

3. **Внезапные новости**
   - Резкие движения без технических причин
   - Митигация: быстрый перевод в безубыток, экстренное закрытие при потере связи

4. **Ликвидация**
   - При плече 10x возможна быстрая ликвидация
   - Митигация: изолированная маржа (одна позиция не влияет на другие), минимальные размеры

### Ограничения

1. **Не работает на низколиквидных монетах** - фокус только на топ-40
2. **Требует стабильного интернет-соединения** - критично для real-time данных
3. **Зависит от качества API биржи** - задержки могут повлиять на результаты

---

## Метрики успеха

### KPI для тестирования

1. **Win Rate** - процент прибыльных сделок (ожидается 30-40%)
2. **Profit Factor** - отношение общей прибыли к общим убыткам (цель > 2.0)
3. **Average Win / Average Loss** - соотношение (цель > 5:1)
4. **Maximum Drawdown** - максимальная просадка (цель < 10%)
5. **Sharpe Ratio** - доходность с учетом риска

### Критерии успешности стратегии

**Минимальные требования:**
- Profit Factor > 1.5 (прибыль покрывает убытки в 1.5+ раз)
- Max Drawdown < 15%
- Положительный результат за 30+ дней тестирования

**Оптимальные показатели:**
- Profit Factor > 2.5
- Win Rate > 35%
- Max Drawdown < 10%

---

## Дальнейшее развитие

### Краткосрочные улучшения (после начального тестирования)

1. **Telegram уведомления** - алерты о входах/выходах
2. **Web dashboard** - визуализация позиций и статистики
3. **Детекция спуфинга** - ML-модель для фильтрации ложных плотностей

### Среднесрочные улучшения

1. **Machine Learning для оптимизации** - автоматический подбор параметров
2. **Интеграция дополнительных бирж** - Binance, BitGet
3. **Multi-timeframe анализ** - учет трендов на разных таймфреймах

### Долгосрочные улучшения

1. **Комбинированные стратегии** - пробой+отскок одновременно
2. **Корреляционный анализ** - учет взаимосвязей между монетами
3. **Sentiment analysis** - интеграция социальных сигналов

---

**Документ создан:** 2025-11-06
**Автор:** Claude Code (на основе требований пользователя)
**Статус:** Готов к реализации
